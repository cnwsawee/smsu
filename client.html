<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<script src="./js/eventList.js"></script>
	<link rel="stylesheet" href="./vendor/css/bootstrap.min.css">
	<script src="./vendor/js/socket.io.js"></script>
	<script src="./vendor/js/jquery-3.4.1.min.js"></script>
	<script type="text/javascript" src="./vendor/js/bootstrap.js"></script>
	<style type="text/css">
		.progress{
			height:50vh;
		}
		.progress-bar{
			position:relative;top:0%; width: 100%;height: 100%;
			-webkit-transition: width 2.5s ease;
    		transition: width 2.5s ease;
	}
		}
		body {
   			padding-left: 10px;
		}
		.statusNumber{
			font-size: 30pt;
			text-align: center;
		}
		.col-sm-4{
			padding-left: 2px;
			padding-right: 2px;
			width: 33%;
		}
		.col-sm-2{
			width: 20%;
		}
		.col-sm-1{
			padding-left: 2px;
			width: 2%;
		}
		.liEvent{
			text-align: center;
			font-size: 10pt;
		}
	</style>
</head>
<body>	
	<div class="container">
		<div class="modal" tabindex="-1" role="dialog" id="statModal">
  			<div class="modal-dialog" role="document">
    			<div class="modal-content">
      				<div class="modal-header">
        				<h5 class="modal-title">Modal title</h5>
        					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
          						<span aria-hidden="true">&times;</span>
        				</button>
      				</div>
      				<div class="modal-body">
        				<div class="row">
					Phy
					<span class="form-group">
						<input type="text" id="phy">
					</span>
				</div>
				<div class="row">
					Res
					<span class="form-group">
						<input type="text" id="res">
					</span>
				</div>
				<div class="row">
					Int
					<span class="form-group">
						<input type="text" id="int">
					</span>
				</div>
      				</div>
      				<div class="modal-footer">
       					<button type="button" class="btn btn-primary" id="submitStat">Save changes</button>
      				</div>
    			</div>
  			</div>
		</div>
		<div class="row">
			<div class="col-md-4 col-sm-4">
				<ul class="list-group" id="listRegen"></ul>
			</div>
			<div class="col-md-4 col-sm-4">
				<ul class="list-group" id="listKnowledge"></ul>
			</div>
			<div class="col-md-4 col-sm-4">
				<ul class="list-group" id="listXp"></ul>
			</div>
		</div>
		<div class="row" style="display:none;">
			<button class = "btn btn-primary" id="submitEvent"> Submit event</button>
		</div>
		<br>
		<br>
		<div class="row" style="text-align: center;">
			<br>
			<br>
			<div class="col-md-2 col-sm-2">
				<div class="progress">
						    		<div class="progress-bar bg-primary" role="progressbar" style="" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" id= "hp">
						    	</div>
						 </div>
						 <span class="statusNumber" id="hp1">10<span>
			</div>
			<div class="col-md-1 col-sm-1">
				
			</div>
			<div class="col-md-2 col-sm-2">
				<div class="progress">
						    		<div class="progress-bar bg-primary" role="progressbar" style="" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" id= "mp">
						    	</div>
						 </div>
						 <span class="statusNumber" id="mp1">10<span>
			</div>
			<div class="col-md-1 col-sm-1">
				
			</div>
			<div class="col-md-2 col-sm-2">
				<div class="progress">
						    		<div class="progress-bar bg-primary" role="progressbar" style="" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" id= "kp">
						    	</div>
						 </div>
						 <span class="statusNumber" id="kp1">0<span>
			</div>
			<div class="col-md-1 col-sm-1">
				
			</div>
			<div class="col-md-2 col-sm-2">
				<div class="progress">
						    		<div class="progress-bar bg-primary" role="progressbar" style="" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" id= "xp">
						    	</div>
						 </div>
						 <span class="statusNumber" id="xp1">0<span>
			</div>
		</div>
	</div>
	
	<script >
		(function(){
			
			var socket = io();
			var username = window.location.pathname.substr(5, window.location.pathname.length);
			var eventPoolRegen = [];
			var eventPoolKnowledge = [];
			var eventPoolXp = [];
			var eventRegen = getRegen();
			var eventKnowledge = getKnowledge();
			var eventXp = getXp();
			var activeEvent =[username,3,0];
			var upd = function(name, val){
				//$('#'+name).css('height',(val*5)+'%');
				$('#'+name).animate({
					top: 100-(val*5) +'%',
					height: val*5 +'%'
				},1000);	
				$('#'+name).attr('aria-valuenow'+(val*5));
				//$('#'+name).css('top',100-(val*5)+'%')
				//$("#"+name).text(val);
				$("#"+name+'1').text(val);
			}
			var progressColor = function(name, val){
				if(val <5){
					if($('#'+name).hasClass('bg-warning')){
						$('#'+name).removeClass('bg-warning');
					}
					if($('#'+name).hasClass('bg-danger')){
						$('#'+name).removeClass('bg-danger');
					}
					$('#'+name).addClass('bg-danger');
				}
				else if(val >=5 && val <10){
					if($('#'+name).hasClass('bg-warning')){
						$('#'+name).removeClass('bg-warning');
					}
					if($('#'+name).hasClass('bg-danger')){
						$('#'+name).removeClass('bg-danger');
					}
					$('#'+name).addClass('bg-warning');	
				}
				else{
					if($('#'+name).hasClass('bg-warning')){
						$('#'+name).removeClass('bg-warning');
					}
					if($('#'+name).hasClass('bg-danger')){
						$('#'+name).removeClass('bg-danger');
					}
				}
			}
			var progressColorKn = function(name, val){
				if(val <5){
					if($('#'+name).hasClass('bg-warning')){
						$('#'+name).removeClass('bg-warning');
					}
					if($('#'+name).hasClass('bg-danger')){
						$('#'+name).removeClass('bg-danger');
					}
					if($('#'+name).hasClass('bg-success')){
						$('#'+name).removeClass('bg-success');
					}
					$('#'+name).addClass('bg-danger');
				}
				else if(val >=5 && val <10){
					if($('#'+name).hasClass('bg-warning')){
						$('#'+name).removeClass('bg-warning');
					}
					if($('#'+name).hasClass('bg-danger')){
						$('#'+name).removeClass('bg-danger');
					}
					if($('#'+name).hasClass('bg-success')){
						$('#'+name).removeClass('bg-success');
					}
					$('#'+name).addClass('bg-warning');	
				}
				else if(val >=10 && val<15){
					if($('#'+name).hasClass('bg-warning')){
						$('#'+name).removeClass('bg-warning');
					}
					if($('#'+name).hasClass('bg-danger')){
						$('#'+name).removeClass('bg-danger');
					}
					if($('#'+name).hasClass('bg-success')){
						$('#'+name).removeClass('bg-success');
					}
					$('#'+name).addClass('bg-success');
				}
			}
			$(document).ready(function(){
				if(socket !== undefined){
					console.log('Connected');
				};
				socket.emit('start',username);
				socket.on('statSubmission'+username,function(data){
					if(data == 0){
						$('#statModal').modal("show");
					}
				});
				socket.on('eventRegen',function(data){
					eventPoolRegen = data;
					$("#listRegen").empty();
					eventPoolRegen.forEach(function(element,index){
						$("#listRegen").append("<li class=\"list-group-item liRegen liEvent\" id=\"eventRegen"+element+"\">"+eventRegen[element][0]);
						//$("#eventRegen"+element).unbind('click');
						$("#eventRegen"+element).click(function(){
							$("li[id*='event']").each(function(){
								$(this).removeClass('active');
							})
							$(this).addClass('active');
							activeEvent =[username,0,element];
						});
					});
				});
				socket.on('eventKnowledge',function(data){
					eventPoolKnowledge = data;
					$("#listKnowledge").empty();
					eventPoolKnowledge.forEach(function(element,index){
						$("#listKnowledge").append("<li class=\"list-group-item liKnowledge liEvent\" id=\"eventKnowledge"+element+"\">"+eventKnowledge[element][0]);
						//$("#eventKnowledge"+element).unbind('click');
						$("#eventKnowledge"+element).click(function(){
							$("li[id*='event']").each(function(){
								$(this).removeClass('active');
							})
							$(this).addClass('active');
							activeEvent =[username,1,element];
						});	
					})
				});
				socket.on('eventXp',function(data){
					eventPoolXp = data;
					$("#listXp").empty();
					eventPoolXp.forEach(function(element,index){
						$("#listXp").append("<li class=\"list-group-item liXp liEvent\" id=\"eventXp"+element+"\">"+eventXp[element][0]);
						//$("#eventXp"+element).unbind('click');
						$("#eventXp"+element).click(function(){
							$("li[id*='event']").each(function(){
								$(this).removeClass('active');
							})
							$(this).addClass('active');
							activeEvent =[username,2,element];
						});
					})
				});

				socket.on('updateScore'+ username, function(data){
					upd('hp',data[1]);
					progressColor('hp',data[1]);
					upd('mp',data[2]);
					progressColor('mp',data[2]);
					upd('kp',data[3]);
					progressColorKn('kp',data[3]);
					upd('xp',data[4]);
					progressColorKn('xp',data[4]);

				});

				socket.on('changeColor'+ username, function(data){
					console.log(data);
					$("body").css("background-color","#"+data);
					
				});
				/*
				socket.on('submit', function(data){

				});
				*/
				$("#submitStat").click(function(){
					var arr=[];
					arr.push(parseInt(username));
					arr.push(parseInt($('#phy').val()));
					arr.push(parseInt($('#res').val()));
					arr.push(parseInt($('#int').val()));
					socket.emit("sendStat",arr);
					$('#statModal').modal("hide");
				});

				socket.on('requestEvent',function(data){
					socket.emit('sendEvent',activeEvent);
					$("li[id*='event']").each(function(){
						$(this).removeClass('active');
					})
					activeEvent=[username,3,0];
				})

				$("#submitEvent").click(function(){
					console.log(activeEvent);
					socket.emit('sendEvent',activeEvent);
				});

			});
		})();	
	</script>
</body>